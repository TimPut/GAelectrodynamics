%
% Copyright © 2016 Peeter Joot.  All Rights Reserved.
% Licenced as described in the file LICENSE under the root directory of this GIT repository.
%
%{
\index{Green's function}

\subsection{Motivation.}

We will now introduce Green's functions, which provide a general method of solving many of the linear differential equations that will be encountered in electromagnetism.

One such linear differential equation is the inhomogeneous wave equation

\begin{dmath}\label{eqn:gradientGreensFunctionEuclidean:162}
\lr{ \spacegrad^2 - \inv{c^2} \PDSq{t}{} } F(\Bx, t) = B(\Bx, t)
\end{dmath}

The time harmonic (frequency domain) representation of the wave equation can be found by assuming a that fixed frequency solution exists.
In complex notation, that means that we can assume that all sources and fields have a complex exponential time dependence of the form
\footnote{This is the engineering convention for the time dependence.
The reader must take care when reading the literature, since some authors (notably in physics) use the opposite sign convention
\( F(\Bx, t) = \Real\lr{ F(\Bx) e^{-i \omega t }} \).}

\index{time harmonic}
\index{frequency domain}
\begin{dmath}\label{eqn:gradientGreensFunctionEuclidean:60}
F(\Bx, t) = \Real\lr{ F(\Bx) e^{j \omega t} },
\end{dmath}

where \( j \) is a scalar imaginary that need not be represented by any geometrical imaginary such as \( \Be_{123}, \Be_{12}, \cdots \).
After substitution of the time harmonic representation into \cref{eqn:gradientGreensFunctionEuclidean:162}, the problem is reduced to finding a solution that is a function of space and time to one that is purely spatial

\begin{dmath}\label{eqn:gradientGreensFunctionEuclidean:159}
\lr{ \spacegrad^2 + \frac{\omega^2}{c^2} } F(\Bx) = B(\Bx).
\end{dmath}

Superposition of discrete or continuous combinations of fixed frequency solutions, once found, can be used to determine more general solutions to the original wave equation \cref{eqn:gradientGreensFunctionEuclidean:162}.

We will writing \( \omega^2/c^2 = k^2 \), to obtain the standard form of the Helmholtz equation we wish to solve

\index{Helmholtz equation}
\index{second order Helmholtz equation}
\begin{dmath}\label{eqn:gradientGreensFunctionEuclidean:160}
\lr{ \spacegrad^2 + k^2 } F(\Bx) = B(\Bx).
\end{dmath}

This is a linear differential equation that is second order with respect to the gradient.
Despite employing a complex representations of the fields and sources, our vector basis is still a real valued Euclidean basis, and we will have no reason to introduce complex inner products spaces into the mix.
We will also encounter statics problems that have no time dependence in electromagnetism.
Some of these problems have the structure of \cref{eqn:gradientGreensFunctionEuclidean:160} with \( k = 0 \), and for those problems the fields and sources are real.

\index{Helmholtz operator}
Observe that the Helmholtz operator can be factored into operators that are first order in the gradient

\begin{dmath}\label{eqn:gradientGreensFunctionEuclidean:161}
\lr{ \spacegrad - j k }\lr{ \spacegrad + j k } F(\Bx) = B(\Bx).
\end{dmath}

We will see that the time harmonic Maxwell's equation, in its GA form, is a first order equation in the gradient of the form

\index{first order Helmholtz equation}
\begin{dmath}\label{eqn:gradientGreensFunctionEuclidean:180}
\lr{ \spacegrad + j k } F(\Bx) = J(\Bx),
\end{dmath}

where \( F \) is a (complex) 1,2 multivector, and \( J \) is a (complex) multivector containing all the charge and current density contributions.
Our initial goal is to develop the Green's function toolbox that can be used to solve first and second order Helmholtz equations of the form
\cref{eqn:gradientGreensFunctionEuclidean:180} and
\cref{eqn:gradientGreensFunctionEuclidean:160} respectively.

\subsection{Unbounded superposition solutions for the Helmholtz equation.}

We can utilize \cref{eqn:gradientGreensFunctionEuclidean:160} to illustrate the Green's function technique.
As this equation is a linear differential operator relating the wave and the driving sources,
it is reasonable to assume that the solution also has a general linear structure, such as

\begin{dmath}\label{eqn:gradientGreensFunctionEuclidean:100}
F(\Bx) = \int dV' B(\Bx') G(\Bx, \Bx') + F_0(\Bx),
\end{dmath}

where the function \( G(\Bx, \Bx') \) is called the Green's function for the Helmholtz operator, and \( F_0 \) is any particular solution to the inhomogeneous Helmholtz equation \( \lr{ \spacegrad^2 + k^2 } F_0 = 0 \).
Operating on \cref{eqn:gradientGreensFunctionEuclidean:100} with the Helmholtz operator \( \spacegrad + k^2 \) we find that the Green's function must
satisfy

\begin{dmath}\label{eqn:gradientGreensFunctionEuclidean:140}
\lr{ \spacegrad^2 + k^2 } G(\Bx, \Bx') = \delta(\Bx - \Bx').
\end{dmath}

While it is possible \citep{schwinger1998classical} to derive the Green's function using Fourier transform techniques, we will state the result instead, which is well known

\index{Helmholtz!Green's function}
\index{Green's function!Helmholtz}
\maketheorem{Green's function for the Helmholtz operator.}{thm:gradientGreensFunctionEuclidean:3}{
The advancing (causal), and the receding (acausal) Green's functions satisfying
\cref{eqn:gradientGreensFunctionEuclidean:140} are respectively

\begin{equation*}
\begin{aligned}
G_{\textrm{adv}}(\Bx, \Bx') &= -\frac{e^{-j k \Norm{ \Bx - \Bx' } }}{ 4 \pi \Norm{\Bx - \Bx'}} \\
G_{\textrm{rec}}(\Bx, \Bx') &= -\frac{e^{j k \Norm{ \Bx - \Bx' } }}{ 4 \pi \Norm{\Bx - \Bx'}}.
\end{aligned}
\end{equation*}
} % theorem

We will use the advancing Green's function, and refer to this function as \( G(\Bx, \Bx') \) without any subscript.
A demonstration that these Green's function representations are valid can be found in \cref{chap:helmholtzGreens}.

\index{Laplacian!Green's function}
\index{Green's function!Laplacian}
Observe that as a special case, the Helmholtz Green's function reduces to the Green's function for the Laplacian when \( k = 0 \)

\begin{dmath}\label{eqn:gradientGreensFunctionEuclidean:80}
G(\Bx, \Bx') = -\inv{ 4 \pi \Norm{\Bx - \Bx'}}.
\end{dmath}

\subsection{Bounded superposition solutions for the Helmholtz equation.}

When the presumed solution is a superposition of only states in a bounded region, such as

\begin{dmath}\label{eqn:gradientGreensFunctionEuclidean:200}
F(\Bx) = \int_V dV' B(\Bx') G(\Bx, \Bx') + F_0(\Bx),
\end{dmath}

then life gets a bit more interesting.
For such problems, we require Green's theorem, which must be generalized slightly for use with multivector fields.
The basic idea is that we can relate the Laplacian's of the Green's function and the field
\( F(\Bx') (\spacegrad')^2 G(\Bx, \Bx') = G(\Bx, \Bx') (\spacegrad')^2 F(\Bx') + \cdots \).
That relation is usually expressed in terms of the difference of the two in the integral domain

\maketheorem{Green's theorem}{thm:gradientGreensFunctionEuclidean:220}{
Given a multivector function \( F \) and a scalar function \( G \)
\begin{equation*}
\int_V \lr{ F \spacegrad^2 G - G \spacegrad^2 F } dV = \int_{\partial V} \lr{ F \ncap \cdot \spacegrad G - G \ncap \cdot \spacegrad F },
\end{equation*}
where \( \partial V \) is the boundary of the volume \( V \).
} % theorem

A straightforward, but perhaps inelligant way of proving this theorem is to expand the sandwich difference in coordinates

\begin{dmath}\label{eqn:gradientGreensFunctionEuclidean:260}
F \spacegrad^2 G - G \spacegrad^2 F
=
\sum_k F \partial_k \partial_k G - G \partial_k \partial_k F
=
\sum_k \partial_k \lr{
F \partial_k G - G \partial_k F
}
-
(\partial_k F)(\partial_k G) + (\partial_k G)(\partial_k F).
\end{dmath}

Since \( G \) is a scalar, the last two terms cancel, and we can integrate

\begin{dmath}\label{eqn:gradientGreensFunctionEuclidean:280}
\int_V \lr{ F \spacegrad^2 G - G \spacegrad^2 F } dV
=
\sum_k \int_V \partial_k \lr{ F \partial_k G - G \partial_k F }.
\end{dmath}

Each integral above involves one component of the gradient.
From the fundamental theorem of geometric calculus \cref{thm:fundamentalTheoremOfCalculus:1}
we know that
\begin{dmath}\label{eqn:gradientGreensFunctionEuclidean:300}
\int_V \spacegrad Q dV = \int_{\partial V} \ncap Q dA,
\end{dmath}

for any multivector \( Q \).
Equating components gives

\begin{dmath}\label{eqn:gradientGreensFunctionEuclidean:340}
\int_V \partial_k Q dV = \int_{\partial V} \ncap \cdot \Be_k Q dA,
\end{dmath}

which can be substituted into \cref{eqn:gradientGreensFunctionEuclidean:280} to find

\begin{dmath}\label{eqn:gradientGreensFunctionEuclidean:360}
\int_V \lr{ F \spacegrad^2 G - G \spacegrad^2 F } dV
=
\sum_k \int_{\partial V} \ncap \cdot \Be_k \lr{ F \partial_k G - G \partial_k F } dA
=
\int_{\partial V} \lr{ F (\ncap \cdot \spacegrad) G - G (\ncap \cdot \spacegrad) F } dA,
\end{dmath}

which proves the theorem.
For our application of
{thm:gradientGreensFunctionEuclidean:3} to the Helmholtz problem, we
are actually interested in a antisymmetric sandwich of the Helmholtz operator by the function \( F \) and the scalar (Green's) function \( G \), but
that reduces to a sandwich of Laplacian's

\begin{dmath}\label{eqn:gradientGreensFunctionEuclidean:240}
F \lr{ \spacegrad^2 + k^2 } G - G \lr{ \spacegrad^2 + k^2 } F
=
F \spacegrad^2 G + \cancel{F k^2 G} - G \spacegrad^2 F - \cancel{G k^2 F}
=
F \spacegrad^2 G - G \spacegrad^2 F,
\end{dmath}

so

\begin{dmath}\label{eqn:gradientGreensFunctionEuclidean:380}
\int_V F(\Bx') \lr{ (\spacegrad')^2 + k^2 } G(\Bx, \Bx')
=
\int_V G(\Bx, \Bx') \lr{ (\spacegrad')^2 + k^2} F(\Bx') dV'
+
\int_{\partial V} \lr{ F(\Bx') (\ncap' \cdot \spacegrad') G(\Bx, \Bx') - G(\Bx, \Bx') (\ncap' \cdot \spacegrad') F(\Bx') } dA'
\end{dmath}

This shows that if we assume the Green's function satisfies
the delta function condition
\cref{eqn:gradientGreensFunctionEuclidean:140}
%that was also true for the unbounded case
, then the general solution to \cref{eqn:gradientGreensFunctionEuclidean:160} is

\boxedEquation{eqn:gradientGreensFunctionEuclidean:400}{
\begin{aligned}
F(\Bx) &=
\int_V G(\Bx, \Bx') B( \Bx' ) dV' \\
&+
\int_{\partial V} \lr{
 G(\Bx, \Bx') (\ncap' \cdot \spacegrad') F(\Bx')
-F(\Bx') (\ncap' \cdot \spacegrad') G(\Bx, \Bx')
} dA'.
\end{aligned}
}

We are also free to add in any specific solution \( F_0(\Bx) \) that satisfies the
homogeneous Helmholtz equation.
There is also freedom to add any solution of the homogeneous Helmholtz equation to the Green's function itself, so it is not unique.
For a bounded superposition we generally desire that the solution \( F \) and its normal derivative, or the Green's function \( G \) (and it's normal derivative) or an appropriate combination of the two are zero on the boundary, so that the surface integral is killed.

\subsection{First order gradient Green's functions.}

\index{gradient!Green's function}
\index{Green's function!gradient representation}

We will see that the GA formulation of the statics equations (no time dependence), all have the form

\begin{dmath}\label{eqn:gradientGreensFunctionEuclidean:420}
\spacegrad F(\Bx) = J(\Bx),
\end{dmath}

where \( F, J \) are multivector fields and sources respectively.  We can assume an unbounded superposition solution

\begin{dmath}\label{eqn:gradientGreensFunctionEuclidean:440}
F(\Bx) = \int G(\Bx, \Bx') J(\Bx') dV' + F_0(\Bx),
\end{dmath}

where \( F_0 \) is any solution to the homogeneous gradient equation \( \spacegrad F_0 = 0 \), and operate on this presumed solution with the gradient to find

\begin{dmath}\label{eqn:gradientGreensFunctionEuclidean:460}
J(\Bx)
= \int \spacegrad G(\Bx, \Bx') J(\Bx') dV',
\end{dmath}

so the Green's function \( G \) for this system must satisfy

\begin{dmath}\label{eqn:gradientGreensFunctionEuclidean:480}
\spacegrad G(\Bx, \Bx') = \delta( \Bx - \Bx' ).
\end{dmath}

We will now show that this Green's function is vector valued as follows

\maketheorem{Green's function for the gradient}{thm:gradientGreensFunctionEuclidean:1}{
A Green's function that satisfies \cref{eqn:gradientGreensFunctionEuclidean:480} is
\begin{equation*}
   G(\Bx, \Bx') = \inv{4 \pi} \frac{\Bx - \Bx'}{\Norm{\Bx-\Bx'}^3}.
\end{equation*}
At points \( \Bx \ne \Bx' \), \( \spacegrad \wedge G = 0 \), or
\( \rspacegrad G = G \lspacegrad \).
} % theorem

To prove this, observe that we know the Laplacian representation of the delta function, so
the Green's function for the gradient can be written as

\begin{equation}\label{eqn:gradientGreensFunctionEuclidean:481}
\spacegrad G(\Bx, \Bx') = \delta( \Bx - \Bx' ) = \spacegrad^2 \lr{ -\inv{4\pi} \inv{ \Norm{\Bx - \Bx'} } }.
\end{equation}

GA provides us the rather beautiful and remarkable ability to factor the Laplacian in to a product of gradients \( \spacegrad^2 = \spacegrad \spacegrad \), so the gradient's Green's function is

\begin{dmath}\label{eqn:gradientGreensFunctionEuclidean:580}
G(\Bx, \Bx')
= \spacegrad \lr{ -\inv{4\pi} \inv{ \Norm{\Bx - \Bx'} } }
= -\inv{4\pi} \rcap \PD{r}{} \inv{r},
\end{dmath}

where \( \Br = \Bx - \Bx', r = \Norm{\Br} \), and \( \rcap = \Br/r \).  Proceeding with the derivatives, we find
\begin{dmath}\label{eqn:gradientGreensFunctionEuclidean:600}
G(\Bx, \Bx')
= -\inv{4\pi} \rcap \lr{ -\inv{r^2} }
= \frac{\rcap}{4 \pi r^2},
\end{dmath}

as claimed.  To show that the Green's function commutes with the gradient at points \( \Bx \ne \Bx' \) we can compute the (bivector) curl

\begin{dmath}\label{eqn:gradientGreensFunctionEuclidean:620}
\spacegrad \wedge \frac{\Br}{r^3}
=
\lr{ \spacegrad \inv{r^3}} \wedge \Br
+
\inv{r^3} \spacegrad \wedge \Br.
\end{dmath}

Since \( \spacegrad \inv{r^m} \propto \rcap \) the first wedge is zero.  The second wedge is also zero, which is easily demonstrated by coordinate expansion
\begin{dmath}\label{eqn:gradientGreensFunctionEuclidean:640}
\spacegrad \wedge \Br
=
\sum_{m,n} (\Be_m \partial_m) \wedge (\Be_n r_n)
=
\sum_{m,n} (\Be_m \wedge \Be_n) \partial_m r_n
=
\sum_{m,n} (\Be_m \wedge \Be_n) \delta_{m n}.
\end{dmath}

This last sum is zero since it is the symmetric sum of an antisymmetric quantity, which completes the proof.

We can determine the structure of an unbounded superposition solution through application of
the fundamental theorem of geometric calculus \cref{thm:fundamentalTheoremOfCalculus:1}

\begin{dmath}\label{eqn:gradientGreensFunctionEuclidean:500}
\int_V G(\Bx, \Bx') \lrspacegrad' F(\Bx') dV'
=
\int_V (G(\Bx, \Bx') \lspacegrad') F(\Bx') dV'
+
\int_V G(\Bx, \Bx') (\rspacegrad' F(\Bx')) dV'
=
\int_{\partial V} G(\Bx, \Bx') \ncap' F(\Bx') dA'.
\end{dmath}

As with the Helmholtz equation, we can presuming that the Green's function of
\cref{thm:gradientGreensFunctionEuclidean:1}
for the unbounded superposition solution also applies here.  Since

\begin{dmath}\label{eqn:gradientGreensFunctionEuclidean:520}
G(\Bx, \Bx') \lspacegrad'
=
-G(\Bx', \Bx) \lspacegrad'
=
-
\spacegrad' G(\Bx', \Bx)
= -\delta(\Bx - \Bx'),
\end{dmath}

we have
\begin{dmath}\label{eqn:gradientGreensFunctionEuclidean:540}
-F(\Bx)
+
\int_V G(\Bx, \Bx') J(\Bx') dV'
=
\int_{\partial V} G(\Bx, \Bx') \ncap' F(\Bx') dA',
\end{dmath}

or
\boxedEquation{eqn:gradientGreensFunctionEuclidean:560}{
F(\Bx)
=
\int_V G(\Bx, \Bx') J(\Bx') dV'
-
\int_{\partial V} G(\Bx, \Bx') \ncap' F(\Bx') dA'.
}

We are also free to add any specific solution \( F_0 \) to the gradient equation \( \spacegrad F_0 = 0 \).
Because the Green's function is not unique (we can add any solution \( G_0 \) of the gradient equation \( \spacegrad G_0 = 0 \)),
it may be desirable for bounded problems to construct Green's functions that are zero on the boundary of the integration volume.

\subsection{Green's function for the first order Helmholtz equation.}

The non-zero frequency generalization of the gradient equations above are multivector equations of the form

\begin{dmath}\label{eqn:gradientGreensFunctionEuclidean:660}
\lr{ \spacegrad + j k } F(\Bx) = J(\Bx).
\end{dmath}

As above, this can be solved by assuming a superposition solution

\begin{dmath}\label{eqn:gradientGreensFunctionEuclidean:680}
F(\Bx) = \int G(\Bx, \Bx') J(\Bx') dV',
\end{dmath}

where
\begin{dmath}\label{eqn:gradientGreensFunctionEuclidean:700}
\lr{ \spacegrad + j k } G(\Bx, \Bx')  = \delta(\Bx - \Bx').
\end{dmath}

FIXME: this basic idea has been repeated over and over again.  Probably worth stating it once up front.

This Green's function is multivector valued

\maketheorem{Green's function for the first order Helmholtz operator.}{thm:gradientGreensFunctionEuclidean:720}{
The Green's function satisfying
\begin{equation*}
\lr{ \rspacegrad + j k } G(\Bx, \Bx') = G(\Bx, \Bx') \lr{ -\lspacegrad' + j k } = \delta(\Bx - \Bx'),
\end{equation*}
is
\begin{equation*}
G(\Bx, \Bx') = \frac{e^{-j k r}}{4 \pi r} \lr{ j k \lr{ 1 + \rcap } + \frac{\rcap}{r} },
\end{equation*}
where \( \Br = \Bx - \Bx', r = \Norm{\Br} \) and \( \rcap = \Br/r \).
} % theorem

If we denote the (advanced) Green's function for the 2nd order Helmholtz operator
\cref{thm:gradientGreensFunctionEuclidean:3}
as \( \phi(\Bx, \Bx') \), we must have

\begin{equation}\label{eqn:gradientGreensFunctionEuclidean:740}
\lr{ \rspacegrad + j k } G(\Bx, \Bx') = \delta(\Bx - \Bx') =
\lr{ \rspacegrad + j k } \lr{ \rspacegrad - j k } \phi(\Bx, \Bx'),
\end{equation}

we see that the Green's function is given by
\begin{dmath}\label{eqn:gradientGreensFunctionEuclidean:760}
G(\Bx, \Bx')
=
\lr{ \rspacegrad - j k } \phi(\Bx, \Bx').
\end{dmath}

This can be computed directly

\begin{dmath}\label{eqn:gradientGreensFunctionEuclidean:780}
G(\Bx, \Bx')
=
\lr{ \rspacegrad - j k } \rcap \PD{r}{} \lr{ -\frac{e^{-j k r}}{4 \pi r} }
=
\frac{-e^{-j k r}}{4 \pi}
\lr{
\rcap \lr{ -\frac{j k}{r} - \inv{ r^2 } } - \frac{j k}{r}
}
=
\frac{e^{-j k r}}{4 \pi}
\lr{
j k \lr{ 1 + \rcap } + \frac{\rcap}{r}
},
\end{dmath}

as claimed.
Observe that since \( \phi \) is scalar valued, we can also rewrite
\cref{eqn:gradientGreensFunctionEuclidean:760} in terms of a right acting operator

\begin{dmath}\label{eqn:gradientGreensFunctionEuclidean:800}
G(\Bx, \Bx')
=
\phi(\Bx, \Bx')
\lr{ \lspacegrad - j k }
=
\phi(\Bx, \Bx')
\lr{ -\lspacegrad' - j k },
\end{dmath}

so
\begin{equation}\label{eqn:gradientGreensFunctionEuclidean:820}
G(\Bx, \Bx') \lr{ -\lspacegrad' + j k } =
\phi(\Bx, \Bx') \lr{ (\lspacegrad')^2 + k^2 }
=
\delta(\Bx - \Bx').
\end{equation}

This is relavant for bounded superposition states, which we will discuss next now that the proof of
\cref{thm:gradientGreensFunctionEuclidean:720} is complete.  In particular, we may rearrange
\cref{eqn:gradientGreensFunctionEuclidean:500}

\begin{dmath}\label{eqn:gradientGreensFunctionEuclidean:840}
\begin{aligned}
-\int_V \lr{ G(\Bx, \Bx') \lspacegrad'} F(\Bx') dV'
&=
\int_V G(\Bx, \Bx') \lr{ \rspacegrad' F(\Bx')} dV' \\
&-
\int_{\partial V} G(\Bx, \Bx') \ncap' F(\Bx') dA',
\end{aligned}
\end{dmath}

and add \( \int_V G(\Bx, \Bx') j k F(\Bx') dV' \) to both sides to find

\begin{dmath}\label{eqn:gradientGreensFunctionEuclidean:860}
\begin{aligned}
\int_V \lr{ G(\Bx, \Bx') \lr{ -\lspacegrad' + j k } } F(\Bx') dV'
&=
\int_V G(\Bx, \Bx') \lr{ \lr{ \rspacegrad' + j k } F(\Bx') } dV' \\
&-
\int_{\partial V} G(\Bx, \Bx') \ncap' F(\Bx') dA'.
\end{aligned}
\end{dmath}

Utilizing \cref{thm:gradientGreensFunctionEuclidean:720}, and substituting \( J(\Bx') \) from \cref{eqn:gradientGreensFunctionEuclidean:660}, we find that one solution is

\begin{dmath}\label{eqn:gradientGreensFunctionEuclidean:880}
F(\Bx)
=
\int_V G(\Bx, \Bx') J(\Bx') dV'
-
\int_{\partial V} G(\Bx, \Bx') \ncap' F(\Bx') dA'.
\end{dmath}

We are free to
add any specific solution \( F_0 \) that satisfies the homogeneous equation \( \lr{ \spacegrad + j k } F_0 = 0 \).

%}
